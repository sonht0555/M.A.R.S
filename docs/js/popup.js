let targetLang="en";const settingBtn=document.getElementById("settingBtn"),setContent=document.getElementById("setContent"),tranContent=document.getElementById("tranContent"),noti=document.getElementById("noti"),lang1st=document.getElementById("lang-1st"),lang2nd=document.getElementById("lang-2nd"),lang3rd=document.getElementById("lang-3rd"),key1st=document.getElementById("key-1st"),key2nd=document.getElementById("key-2nd"),key3rd=document.getElementById("key-3rd"),btn1st=document.getElementById("btn1st"),btn2nd=document.getElementById("btn2nd"),btn3rd=document.getElementById("btn3rd"),fun1st=document.getElementById("fun1st"),fun2nd=document.getElementById("fun2nd"),fun3rd=document.getElementById("fun3rd"),tookey=document.getElementById("tookey"),openApi=document.getElementById("openApi"),outputTextarea=document.getElementById("outputTextarea"),inputTextarea=document.getElementById("inputTextarea"),copy=document.getElementById("copy"),dele=document.getElementById("dele"),AI=document.getElementById("AI"),onOffSwitch=document.getElementById("onOffSwitch");function checkValidate(){chrome.storage.sync.get(["lang1st","lang2nd","lang3rd","key1st","key2nd","key3rd","tookey"],(function(t){const{lang1st:e,lang2nd:n,lang3rd:a,key1st:o,key2nd:d,key3rd:s,tookey:c}=t,l=[e,n,a,o,d,s,c].some((t=>""===t||void 0===t));settingBtn.classList.toggle("active",l),setContent.classList.toggle("set-disable",!l),tranContent.classList.toggle("set-disable",l),noti.classList.toggle("set-disable",!l),document.getElementById("lang-1st").classList.toggle("validate",""===e||void 0===e),document.getElementById("lang-2nd").classList.toggle("validate",""===n||void 0===n),document.getElementById("lang-3rd").classList.toggle("validate",""===a||void 0===a),document.getElementById("key-1st").classList.toggle("validate",""===o||void 0===o),document.getElementById("key-2nd").classList.toggle("validate",""===d||void 0===d),document.getElementById("key-3rd").classList.toggle("validate",""===s||void 0===s),document.getElementById("tookey").classList.toggle("validate",""===c||void 0===c)}))}function applyTranslation(t){document.getElementById("outputTextarea").value=t,autoExpand(document.getElementById("outputTextarea")),chrome.storage.sync.set({translatedText:t},(function(){}))}function checkTextarea(t){chrome.storage.sync.get(["selectedText"],(function(e){const n=e.selectedText;t.style.display=""!==n?"block":"none"}))}function handleButtonClick(t){chrome.storage.sync.get([t],(function(e){const n=e[t];targetLang=n,chrome.storage.sync.set({targetLang:targetLang});const a=document.getElementById("inputTextarea").value;chrome.storage.sync.set({selectedText:a},(function(){}));const o=document.getElementById("prompt").value;translateSelectedText(a,targetLang,o)}))}function getDataInStorage(t,e){document.getElementById(t).addEventListener("change",(function(){var t=this.value,n={};n[e]=t,chrome.storage.sync.set(n)}))}function autoExpand(t){t.style.height="auto",t.style.height=t.scrollHeight+14+"px"}AI.addEventListener("change",(function(){const t=this.checked;chrome.storage.sync.set({AI:t}),this.checked?(Google.classList.add("tc"),GPT.classList.remove("tc"),document.getElementById("flag-logo").textContent="Open"):(Google.classList.remove("tc"),GPT.classList.add("tc"),document.getElementById("flag-logo").textContent="Google")})),settingBtn.addEventListener("click",(function(){settingBtn.classList.toggle("active"),setContent.classList.toggle("set-disable"),tranContent.classList.toggle("set-disable")})),fun1st.addEventListener("change",(function(){var t=this.value;chrome.storage.sync.set({fun1st:t}),console.log("fun1st:",t)})),btn1st.addEventListener("click",(function(){handleButtonClick("lang1st")})),fun2nd.addEventListener("change",(function(){var t=this.value;chrome.storage.sync.set({fun2nd:t}),console.log("fun2nd:",t)})),btn2nd.addEventListener("click",(function(){handleButtonClick("lang2nd")})),fun3rd.addEventListener("change",(function(){var t=this.value;chrome.storage.sync.set({fun3rd:t}),console.log("fun3rd:",t)})),btn3rd.addEventListener("click",(function(){handleButtonClick("lang3rd")})),onOffSwitch.addEventListener("change",(function(){const t=this.checked;chrome.storage.sync.set({onOffSwitchState:t}),this.checked?(On.classList.remove("tc"),document.getElementById("langContent").classList.remove("tc"),document.getElementById("AItrans").classList.remove("tc"),document.getElementById("settingBtn").classList.remove("tc")):(On.classList.add("tc"),document.getElementById("langContent").classList.add("tc"),document.getElementById("AItrans").classList.add("tc"),document.getElementById("settingBtn").classList.add("tc"))})),tookey.addEventListener("change",(function(){var t=this.value;chrome.storage.sync.set({tookey:t}),console.log("tookey:",t)})),openApi.addEventListener("change",(function(){var t=this.value;chrome.storage.sync.set({openApi:t})})),inputTextarea.addEventListener("input",(function(){autoExpand(inputTextarea)})),inputTextarea.addEventListener("keydown",(function(t){if("Enter"!==t.key||t.shiftKey)outputTextarea.value="",autoExpand(outputTextarea);else{t.preventDefault();const e=document.getElementById("inputTextarea").value;if(chrome.storage.sync.set({selectedText:e},(function(){})),""!==e.trim()){const t=document.getElementById("prompt").value;translateSelectedText(e,targetLang,t)}else outputTextarea.value="",outputTextarea.placeholder="No translation content",chrome.storage.sync.set({translatedText:""},(function(){}))}"Enter"===t.key&&(checkTextarea(copy),checkTextarea(dele))})),dele.addEventListener("click",(()=>{inputTextarea.value=outputTextarea.value="",copy.style.display="none",dele.style.display="none",autoExpand(inputTextarea),chrome.storage.sync.set({selectedText:"",translatedText:""})})),copy.addEventListener("click",(()=>{outputTextarea.value="Copied to clipboard!",chrome.storage.sync.get(["translatedText"],(t=>{const e=t.translatedText;navigator.clipboard.writeText(e),setTimeout((function(){outputTextarea.value=e}),600)}))})),document.addEventListener("DOMContentLoaded",(function(){checkTextarea(copy),checkTextarea(dele),checkValidate(),autoExpand(inputTextarea),autoExpand(outputTextarea),getDataInStorage("lang-1st","lang1st"),getDataInStorage("lang-2nd","lang2nd"),getDataInStorage("lang-3rd","lang3rd"),getDataInStorage("key-1st","key1st"),getDataInStorage("key-2nd","key2nd"),getDataInStorage("key-3rd","key3rd"),chrome.storage.sync.get(["onOffSwitchState","AI","lang1st","lang2nd","lang3rd","key1st","key2nd","key3rd","translatedText","selectedText","targetLang","tookey","fun1st","fun2nd","fun3rd","openApi"],(function(t){void 0!==t.onOffSwitchState&&(onOffSwitch.checked=t.onOffSwitchState,1==t.onOffSwitchState?(On.classList.remove("tc"),document.getElementById("langContent").classList.remove("tc"),document.getElementById("AItrans").classList.remove("tc"),document.getElementById("settingBtn").classList.remove("tc")):(On.classList.add("tc"),document.getElementById("langContent").classList.add("tc"),document.getElementById("AItrans").classList.add("tc"),document.getElementById("settingBtn").classList.add("tc"))),void 0!==t.AI&&(AI.checked=t.AI,1==t.AI?(Google.classList.add("tc"),GPT.classList.remove("tc"),document.getElementById("flag-logo").textContent="Open"):(Google.classList.remove("tc"),GPT.classList.add("tc"),document.getElementById("flag-logo").textContent="Google")),btn1st.textContent=t.lang1st,btn2nd.textContent=t.lang2nd,btn3rd.textContent=t.lang3rd,void 0!==t.lang1st&&(lang1st.value=t.lang1st),void 0!==t.lang2nd&&(lang2nd.value=t.lang2nd),void 0!==t.lang3rd&&(lang3rd.value=t.lang3rd),void 0!==t.key1st&&(key1st.value=t.key1st),void 0!==t.key2nd&&(key2nd.value=t.key2nd),void 0!==t.key3rd&&(key3rd.value=t.key3rd),void 0!==t.fun1st&&(fun1st.value=t.fun1st),void 0!==t.fun2nd&&(fun2nd.value=t.fun2nd),void 0!==t.fun3rd&&(fun3rd.value=t.fun3rd),void 0!==t.tookey&&(tookey.value=t.tookey),void 0!==t.openApi&&(openApi.value=t.openApi),t.translatedText&&(outputTextarea.value=t.translatedText,autoExpand(outputTextarea)),t.selectedText&&(inputTextarea.value=t.selectedText,autoExpand(inputTextarea));const{targetLang:e}=t;e&&(targetLang=e)}));const t=["btn1st","btn2nd","btn3rd"].map((t=>document.getElementById(t)));chrome.storage.sync.get(["activeButton"],(function(t){const e=t.activeButton;if(e){const t=document.getElementById(e);t&&t.classList.add("s1")}})),t.forEach((e=>{e.addEventListener("click",(function(){t.forEach((t=>t.classList.remove("s1"))),e.classList.add("s1"),chrome.storage.sync.set({activeButton:e.id})}))}))}));