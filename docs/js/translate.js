let context=null;function setLoadingCursor(){document.body.style.cursor="wait",setTimeout((()=>{document.body.style.cursor="default"}),500)}function langCodeToName(e){return{af:"Afrikaans",sq:"Albanian",am:"Amharic",ar:"Arabic",hy:"Armenian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",bg:"Bulgarian",ca:"Catalan",ceb:"Cebuano",ny:"Chichewa","zh-CN":"Chinese (Simplified)","zh-TW":"Chinese (Traditional)",co:"Corsican",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch",en:"English",eo:"Esperanto",et:"Estonian",tl:"Filipino",fi:"Finnish",fr:"French",fy:"Frisian",gl:"Galician",ka:"Georgian",de:"German",el:"Greek",gu:"Gujarati",ht:"Haitian Creole",ha:"Hausa",haw:"Hawaiian",iw:"Hebrew",hi:"Hindi",hmn:"Hmong",hu:"Hungarian",is:"Icelandic",ig:"Igbo",id:"Indonesian",ga:"Irish",it:"Italian",ja:"Japanese",jw:"Javanese",kn:"Kannada",kk:"Kazakh",km:"Khmer",rw:"Kinyarwanda",ko:"Korean",ku:"Kurdish (Kurmanji)",ky:"Kyrgyz",lo:"Lao",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mg:"Malagasy",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mn:"Mongolian",my:"Myanmar (Burmese)",ne:"Nepali",no:"Norwegian",ps:"Pashto",fa:"Persian",pl:"Polish",pt:"Portuguese",pa:"Punjabi",ro:"Romanian",ru:"Russian",sm:"Samoan",gd:"Scots Gaelic",sr:"Serbian",st:"Sesotho",sn:"Shona",sd:"Sindhi",si:"Sinhala",sk:"Slovak",sl:"Slovenian",so:"Somali",es:"Spanish",su:"Sundanese",sw:"Swahili",sv:"Swedish",tg:"Tajik",ta:"Tamil",tt:"Tatar",te:"Telugu",th:"Thai",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",ur:"Urdu",ug:"Uyghur",uz:"Uzbek",vi:"Vietnamese",cy:"Welsh",xh:"Xhosa",yi:"Yiddish",yo:"Yoruba",zu:"Zulu"}[e]||e}function translateSelectedText(e,t,n){chrome.storage.sync.get(["AI"],(function(a){const{AI:o}=a;if(o)chrome.storage.sync.get(["GeminiAPI"],(async function(a){const o=a.GeminiAPI;if(!o)return void(document.getElementById("outputTextarea").value="ðŸ¤Œ Please insert Gemini API key â‡¢ M.A.R.S settings.");const i=await translateWithGemini(e,t,n,o);setLoadingCursor(),document.getElementById("marsContent")?applyTranslationTooltip(i):applyTranslation(i),console.log("Gemini-AI"),console.log("%cContent%c "+e,"","color: #10B981; font-style: italic;"),console.log("%cTranslated ["+t+"]%c "+i,"","color: #DD5639; font-style: italic;")}));else{const n="https://translate.googleapis.com/translate_a/single?dt=t&dt=bd&dt=ex&dt=ld&dt=md&dt=qca&dt=rw&dt=rm&dt=ss&dt=t&dt=at&client=gtx&hl="+t+"&sl=auto&tl="+t+"&dj=1&source=bubble";var i=new XMLHttpRequest;i.open("POST",n,!1),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onload=function(){if(i.status>=200&&i.status<300){const n=JSON.parse(i.responseText).sentences.map((e=>e.trans)).join(" ");setLoadingCursor(),document.getElementById("marsContent")?applyTranslationTooltip(n):applyTranslation(n),console.log("Google-AI"),console.log("%cContent%c "+e,"","color: #10B981; font-style: italic;"),console.log("%cTranslated ["+t+"]%c "+n,"","color: #DD5639; font-style: italic;")}else console.error("Request failed with status "+i.status);document.getElementById("marsContent")&&(document.getElementById("load").style.opacity="0")},i.onerror=function(){console.error("Request failed"),document.getElementById("marsContent")&&(document.getElementById("load").style.opacity="0")},i.send("q="+encodeURIComponent(e))}}))}async function translateWithGemini(e,t,n,a){document.getElementById("marsContent")?document.getElementById("load").style.opacity="1":document.getElementById("loadings")&&(document.getElementById("loadings").style.opacity="1");const o=`"Translate the following text into ${langCodeToName(t)}: [${e}] with the context: [${n}]. Provide only the translated text as output, without any additional explanations."`;try{const e=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:o}]}]})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);document.getElementById("marsContent")?document.getElementById("load").style.opacity="0":document.getElementById("loadings")&&(document.getElementById("loadings").style.opacity="0");return(await e.json()).candidates[0].content.parts[0].text}catch(e){return console.error("Error during translation:",e),null}}